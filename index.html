<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Barras de carga - Tamaño de cubos Microstrategy con Usuario</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 700px;
            margin: 30px auto;
            padding: 10px;
            background: #f5f5f5;
        }
        h1, h2 {
            text-align: center;
            margin-bottom: 25px;
        }
        .cube-container, .user-container {
            margin-bottom: 20px;
        }
        .cube-label, .user-label {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .bar-background {
            background-color: #ddd;
            border-radius: 8px;
            overflow: hidden;
            height: 30px;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
        }
        .bar-fill {
            height: 100%;
            line-height: 30px;
            color: white;
            font-weight: bold;
            padding-left: 10px;
            box-sizing: border-box;
            border-radius: 8px 0 0 8px;
            white-space: nowrap;
            transition: width 1s ease;
        }
        .testamentaria_vinculos { background-color: #4caf50; }
        .testamentaria_main { background-color: #2196f3; }
        .sac_reclamaciones { background-color: #ff9800; }
        .testamentarias_times_table { background-color: #9c27b0; }
        .usuario_total { background-color: #607d8b; }

        /* Opcional: diferente color para usuarios */
        .user-bar-0 { background-color: #3f51b5; }
        .user-bar-1 { background-color: #009688; }
        .user-bar-2 { background-color: #e91e63; }
        .user-bar-3 { background-color: #ff5722; }
    </style>
</head>
<body>
    <h1>Tamaño de cubos Microstrategy (MB) - Escalado a 1000MB</h1>

    <h2>Cubos por Usuario</h2>
    <div id="bars"></div>

    <h2>Total ocupado por Usuario</h2>
    <div id="userTotals"></div>

    <script>
        // Datos de cubos, ahora con usuario incluido
        const cubes = [
            { name: "Testamentaria_vinculos", sizeMB: 30.595, user: "E043352" },
            { name: "Testamentaria_main", sizeMB: 225.372, user: "E043352" },
            { name: "Sac_reclamaciones", sizeMB: 84.101, user: "E043352" },
            { name: "Testamentarias_times_table", sizeMB: 0.665, user: "E043352" }
        ];

        const totalMB = 1000;  // Total fijo para escala de barras

        const barsContainer = document.getElementById("bars");
        const userTotalsContainer = document.getElementById("userTotals");

        // Mostrar barras por cubo con usuario
        cubes.forEach((cube, index) => {
            let widthPercent = (cube.sizeMB / totalMB) * 100;
            if (widthPercent > 100) widthPercent = 100;

            const container = document.createElement("div");
            container.className = "cube-container";

            // Etiqueta con cubo y usuario
            const label = document.createElement("div");
            label.className = "cube-label";
            label.textContent = `${cube.user}: ${cube.name} — ${cube.sizeMB.toLocaleString()} MB`;
            container.appendChild(label);

            const barBg = document.createElement("div");
            barBg.className = "bar-background";

            const barFill = document.createElement("div");
            barFill.className = "bar-fill";

            // Usar clase de color basada en el cubo para estilo
            const colorClass = cube.name.toLowerCase().replace(/\s+/g, '_');
            barFill.classList.add(colorClass);

            barFill.style.width = "0%";
            barBg.appendChild(barFill);
            container.appendChild(barBg);

            barsContainer.appendChild(container);

            // Animar llenado de barra con pequeño delay para que se vea la animación
            setTimeout(() => {
                barFill.style.width = widthPercent + "%";
            }, 100 + index * 150);
        });

        // Calcular total ocupado por usuario
        const totalByUser = cubes.reduce((acc, cube) => {
            if (!acc[cube.user]) acc[cube.user] = 0;
            acc[cube.user] += cube.sizeMB;
            return acc;
        }, {});

        // Convertir a array para iterar (usuario, size)
        const users = Object.entries(totalByUser);

        // Mostrar barras por usuario total
        users.forEach(([user, sizeMB], idx) => {
            let widthPercent = (sizeMB / totalMB) * 100;
            if (widthPercent > 100) widthPercent = 100;

            const container = document.createElement("div");
            container.className = "user-container";

            const label = document.createElement("div");
            label.className = "user-label";
            const percentFormatted = widthPercent.toFixed(2);
            label.textContent = `${user} — ${sizeMB.toLocaleString()} MB (${percentFormatted}%)`;
            container.appendChild(label);

            const barBg = document.createElement("div");
            barBg.className = "bar-background";

            const barFill = document.createElement("div");
            barFill.className = "bar-fill user-bar-" + (idx % 4);
            // Añadimos clase para color fijo de usuarios, puedes ampliar colores

            barFill.style.width = "0%";
            barBg.appendChild(barFill);
            container.appendChild(barBg);

            userTotalsContainer.appendChild(container);

            setTimeout(() => {
                barFill.style.width = widthPercent + "%";
            }, 100 + idx * 150);
        });
    </script>
</body>
</html>


